task:requests:rate10s = rate(requests{job="s"}[10s])

job:requests:rate10s = sum by (job)(task:requests:rate10s{job="s"})

task:errors:rate10s = rate(errors{job="s"}[10s])

job:errors:rate10s = sum by (job, code)(task:errors:rate10s{job="s"})

job:errors:ratio_rate10s =
   sum by (job)(job:errors:rate10s{job="s"})
     / on (job)
   job:requests:rate10s{job="s"}


ALERT ErrorRatioTooHigh
IF job:errors:ratio_rate10s{job="s"} > 0.2
FOR 10s
WITH { severity="page" }
SUMMARY "Error ratio exceeds 20%"
DESCRIPTION "Error ratio of {{$labels.code}} on {{$labels.job}} is at {{$value}}"
